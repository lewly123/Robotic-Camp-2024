import{initializeApp as L}from"https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";import{setPersistence as S,browserLocalPersistence as D,getAuth as p,createUserWithEmailAndPassword as P,signInWithEmailAndPassword as y,onAuthStateChanged as U,signOut as C}from"https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";import{getFirestore as w,doc as E,setDoc as A,getDocs as R,where as N,query as O,collection as q,getDoc as M}from"https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";import{getStorage as x}from"https://www.gstatic.com/firebasejs/11.1.0/firebase-storage.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();const v={apiKey:"AIzaSyCY95alP5uPQa0UFbUc7iMNLhiPbgCEm40",authDomain:"roboticcamp2024.firebaseapp.com",databaseURL:"https://roboticcamp2024-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"roboticcamp2024",storageBucket:"roboticcamp2024.firebasestorage.app",messagingSenderId:"96247026145",appId:"1:96247026145:web:d90c90532db819ca7202a0"};console.log(v);L(v);function h(r,t){console.log(r)}function B(r){const t=document.getElementById("loginButton"),n=document.querySelector(".dropdown"),s=document.querySelector(".name");if(!t||!n||!s){console.error("UI elements not found!");return}r&&typeof r=="object"?(t.style.display="none",n.style.display="inline-block",s.innerText=r.displayName||"User",localStorage.setItem("loggedInUserId",r.uid)):(t.style.display="inline-block",n.style.display="none",s.innerText="",localStorage.removeItem("loggedInUserId"))}async function W(r,t,n,s,e,o,c,a,d){t(n,a,d).then(i=>{const u=i.user,l={email:a,username:c,password:d},f=o(s,"users",u.uid);e(f,l).then(async()=>{console.log("Success send data to docs");const g=(await r(n,a,d)).user;localStorage.setItem("loggedInUserId",g.uid),window.location.href="https://solstice-salvation.web.app/"}).catch(m=>{console.error("Error writing document",m)})}).catch(i=>{const u=i.code,l=i.message;h(u==="auth/email-already-in-use"?"Email Address Already Exists!":l)})}async function F(r,t,n,s,e,o,c,a,d){try{await S(t,D);let i=a;if(!a.includes("@")){const f=s(n,"users"),m=e(f,o("username","==",a)),g=await c(m);if(!g.empty)i=g.docs[0].data().email,console.log("Resolved username to email:",i);else throw new Error("Username not found.")}const l=(await signInWithEmailAndPassword(t,i,d)).user;B(l),console.log("User signed in:",l),window.location.href="https://solstice-salvation.web.app/"}catch(i){console.error("Error signing in:",i.message)}}const b=p(),I=w();x();document.addEventListener("DOMContentLoaded",function(){document.getElementById("submitButtonRegister").addEventListener("click",function(n){n.preventDefault();const s=document.getElementById("userIdR").value,e=document.getElementById("emailR").value,o=document.getElementById("userPasswordR").value;W(y,P,b,I,A,E,s,e,o)}),document.getElementById("submitButtonLogin").addEventListener("click",function(n){n.preventDefault();const s=document.getElementById("userIdL").value,e=document.getElementById("userPasswordL").value;F(y,b,I,q,O,N,R,s,e)})});const k=p(),T=w();document.addEventListener("DOMContentLoaded",()=>{U(k,async r=>{const t=document.getElementById("loginButton"),n=document.querySelector(".dropdown"),s=document.querySelector(".name");if(document.querySelector(".email"),r){console.log("User is logged in:",r);const e=E(T,"users",r.uid),o=await M(e);if(o.exists()){const c=o.data();s.innerText=c.username||"Guest"}else console.log("No Firestore document found for user.");t.style.display="none",n.style.display="inline-block"}else console.log("No user is logged in."),t.style.display="block",n.style.display="none"})});document.addEventListener("DOMContentLoaded",()=>{const r=p(),t=document.getElementById("logoutButton");t?t.addEventListener("click",function(n){n.preventDefault(),console.log("1"),C(r).then(()=>{console.log("User successfully signed out."),localStorage.removeItem("loggedInUserId"),B(),window.location.href="https://solstice-salvation.web.app/"}).catch(s=>{console.error("Error during logout: ",s.message)})}):console.error("Logout button not found.")});
