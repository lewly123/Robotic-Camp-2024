import{initializeApp as L}from"https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";import{setPersistence as D,browserLocalPersistence as S,getAuth as p,createUserWithEmailAndPassword as U,signInWithEmailAndPassword as y,onAuthStateChanged as P,signOut as C}from"https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";import{getFirestore as w,doc as E,setDoc as R,getDocs as N,where as O,query as q,collection as A,getDoc as M}from"https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();const v={apiKey:"AIzaSyCY95alP5uPQa0UFbUc7iMNLhiPbgCEm40",authDomain:"roboticcamp2024.firebaseapp.com",databaseURL:"https://roboticcamp2024-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"roboticcamp2024",storageBucket:"roboticcamp2024.firebasestorage.app",messagingSenderId:"96247026145",appId:"1:96247026145:web:d90c90532db819ca7202a0"};console.log(v);L(v);function b(s,t){console.log(s)}function B(s){const t=document.getElementById("loginButton"),n=document.querySelector(".dropdown"),r=document.querySelector(".name");if(!t||!n||!r){console.error("UI elements not found!");return}s&&typeof s=="object"?(t.style.display="none",n.style.display="inline-block",r.innerText=s.displayName||"User",localStorage.setItem("loggedInUserId",s.uid)):(t.style.display="inline-block",n.style.display="none",r.innerText="",localStorage.removeItem("loggedInUserId"))}async function x(s,t,n,r,e,o,i,a,d){t(n,a,d).then(c=>{const u=c.user,l={email:a,username:i,password:d},f=o(r,"users",u.uid);e(f,l).then(async()=>{console.log("Success send data to docs");const g=(await s(n,a,d)).user;localStorage.setItem("loggedInUserId",g.uid),window.location.href="https://solstice-salvation.web.app/"}).catch(m=>{console.error("Error writing document",m)})}).catch(c=>{const u=c.code,l=c.message;b(u==="auth/email-already-in-use"?"Email Address Already Exists!":l)})}async function F(s,t,n,r,e,o,i,a,d){try{await D(t,S);let c=a;if(!a.includes("@")){const f=r(n,"users"),m=e(f,o("username","==",a)),g=await i(m);if(!g.empty)c=g.docs[0].data().email,console.log("Resolved username to email:",c);else throw new Error("Username not found.")}const l=(await s(t,c,d)).user;B(l),console.log("User signed in:",l),window.location.href="https://solstice-salvation.web.app/"}catch(c){console.error("Error signing in:",c.message)}}const h=p(),I=w();document.addEventListener("DOMContentLoaded",function(){document.getElementById("submitButtonRegister").addEventListener("click",function(n){n.preventDefault();const r=document.getElementById("userIdR").value,e=document.getElementById("emailR").value,o=document.getElementById("userPasswordR").value;x(y,U,h,I,R,E,r,e,o)}),document.getElementById("submitButtonLogin").addEventListener("click",function(n){n.preventDefault();const r=document.getElementById("userIdL").value,e=document.getElementById("userPasswordL").value;F(y,h,I,A,q,O,N,r,e)})});const k=p(),T=w();document.addEventListener("DOMContentLoaded",()=>{P(k,async s=>{const t=document.getElementById("loginButton"),n=document.querySelector(".dropdown"),r=document.querySelector(".name");if(document.querySelector(".email"),s){console.log("User is logged in:",s);const e=E(T,"users",s.uid),o=await M(e);if(o.exists()){const i=o.data();r.innerText=i.username||"Guest"}else console.log("No Firestore document found for user.");t.style.display="none",n.style.display="inline-block"}else console.log("No user is logged in."),t.style.display="inline-block",n.style.display="none"})});document.addEventListener("DOMContentLoaded",()=>{const s=p(),t=document.getElementById("logoutButton");t?t.addEventListener("click",function(n){n.preventDefault(),console.log("1"),C(s).then(()=>{console.log("User successfully signed out."),localStorage.removeItem("loggedInUserId"),B(),window.location.href="https://solstice-salvation.web.app/"}).catch(r=>{console.error("Error during logout: ",r.message)})}):console.error("Logout button not found.")});
